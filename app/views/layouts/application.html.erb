<!DOCTYPE html>
<html>
  <head>
    <title><%= content_for(:title) || "Hammertime" %></title>
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <%= csrf_meta_tags %>
    <%= csp_meta_tag %>

    <%= yield :head %>

    <link rel="icon" href="/icon.png" type="image/png">
    <link rel="icon" href="/icon.svg" type="image/svg+xml">
    <link rel="apple-touch-icon" href="/icon.png">

    <%= stylesheet_link_tag "tailwind", "data-turbo-track": "reload" %>
    <%= stylesheet_link_tag :app, "data-turbo-track": "reload" %>
    <%= javascript_importmap_tags %>
  </head>

  <body class="min-h-screen bg-slate-100 text-slate-900">
    <% if user_signed_in? %>
      <div class="flex min-h-screen bg-slate-100">
        <aside class="hidden w-72 flex-col border-r border-slate-200 bg-white shadow-sm md:flex">
          <div class="flex items-center justify-between px-6 py-6">
            <div class="flex items-center">
              <%= link_to authenticated_root_path do %>
                <%= image_tag "hammertime logo.png", class: "h-10 w-auto object-contain", alt: "Hammertime" %>
              <% end %>
            </div>
          </div>
          <nav class="flex-1 space-y-1 px-4">
            <%= link_to authenticated_root_path, class: "flex items-center gap-3 rounded-xl px-4 py-2 text-sm font-semibold text-slate-900 transition hover:bg-slate-100" do %>
              <%= heroicon_tag "home", variant: :solid, size: 20, class: "h-5 w-5 text-slate-900" %>
              Dashboard
            <% end %>
            <% if current_user&.owner? || current_user&.admin? %>
              <%= link_to jobs_path, class: "flex items-center gap-3 rounded-xl px-4 py-2 text-sm font-medium text-slate-600 transition hover:bg-slate-100" do %>
                <%= heroicon_tag "briefcase", variant: :outline, size: 20, class: "h-5 w-5 text-slate-500" %>
                Jobs
              <% end %>
            <% end %>
            <%= link_to timesheet_entries_path, class: "flex items-center gap-3 rounded-xl px-4 py-2 text-sm font-medium text-slate-600 transition hover:bg-slate-100" do %>
              <%= heroicon_tag "clock", variant: :outline, size: 20, class: "h-5 w-5 text-slate-500" %>
              Timesheets
            <% end %>
            <%= link_to material_purchases_path, class: "flex items-center gap-3 rounded-xl px-4 py-2 text-sm font-medium text-slate-600 transition hover:bg-slate-100" do %>
              <%= heroicon_tag "wrench-screwdriver", variant: :outline, size: 20, class: "h-5 w-5 text-slate-500" %>
              Materials
            <% end %>
            <% if current_user&.owner? || current_user&.admin? %>
              <%= link_to invoices_path, class: "flex items-center gap-3 rounded-xl px-4 py-2 text-sm font-medium text-slate-600 transition hover:bg-slate-100" do %>
                <%= heroicon_tag "document-text", variant: :outline, size: 20, class: "h-5 w-5 text-slate-500" %>
                Invoices
              <% end %>
              <details class="group">
                <summary class="flex items-center gap-3 rounded-xl px-4 py-2 text-sm font-medium text-slate-600 transition hover:bg-slate-100 cursor-pointer list-none">
                  <%= heroicon_tag "cog-6-tooth", variant: :outline, size: 20, class: "h-5 w-5 text-slate-500" %>
                  Settings
                  <%= heroicon_tag "chevron-down", variant: :solid, size: 16, class: "ml-auto h-4 w-4 text-slate-400 transition group-open:rotate-180" %>
                </summary>
                <div class="mt-2 flex flex-col space-y-1 pl-11">
                  <%= link_to edit_settings_company_path, class: "block rounded-lg px-3 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100" do %>
                    Company Details
                  <% end %>
                  <%= link_to customers_path, class: "block rounded-lg px-3 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100" do %>
                    Customers
                  <% end %>
                  <%= link_to users_path, class: "block rounded-lg px-3 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100" do %>
                    Users
                  <% end %>
                </div>
              </details>
            <% end %>
          </nav>
          <div class="border-t border-slate-200 px-6 py-4">
            <p class="text-xs uppercase tracking-wide text-slate-400">Account</p>
            <p class="mt-2 text-sm font-semibold text-slate-900"><%= current_account&.name || "" %></p>
            <p class="mt-1 text-xs text-slate-500"><%= current_user&.display_name || current_user&.email || "" %></p>
            <div class="mt-3">
              <%= button_to "Sign out", destroy_user_session_path, method: :delete, class: "w-full rounded-xl bg-slate-900 px-4 py-2 text-xs font-semibold text-white hover:bg-slate-800" %>
            </div>
          </div>
        </aside>

        <div class="flex min-h-screen flex-1 flex-col">
          <div class="md:hidden" data-controller="mobile-nav">
            <div class="flex items-center justify-between border-b border-slate-200 bg-white px-4 py-4 shadow-sm">
              <div class="flex items-center gap-3">
                <%= link_to authenticated_root_path do %>
                  <%= image_tag "hammertime logo.png", class: "h-9 w-auto object-contain", alt: "Hammertime" %>
                <% end %>
              </div>
              <button type="button" data-action="mobile-nav#toggle" class="rounded-lg border border-slate-200 p-2 text-slate-600">
                <%= heroicon_tag "bars-3", variant: :outline, size: 18, class: "h-5 w-5" %>
              </button>
            </div>
            <div data-mobile-nav-target="panel" class="hidden border-b border-slate-200 bg-white px-4 py-4">
              <nav class="space-y-2">
                <%= link_to authenticated_root_path, class: "flex items-center gap-3 rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100" do %>
                  <%= heroicon_tag "home", variant: :solid, size: 18, class: "h-5 w-5 text-slate-500" %>
                  Dashboard
                <% end %>
                <% if current_user&.owner? || current_user&.admin? %>
                  <%= link_to jobs_path, class: "flex items-center gap-3 rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100" do %>
                    <%= heroicon_tag "briefcase", variant: :outline, size: 18, class: "h-5 w-5 text-slate-500" %>
                    Jobs
                  <% end %>
                <% end %>
                <%= link_to timesheet_entries_path, class: "flex items-center gap-3 rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100" do %>
                  <%= heroicon_tag "clock", variant: :outline, size: 18, class: "h-5 w-5 text-slate-500" %>
                  Timesheets
                <% end %>
                <%= link_to material_purchases_path, class: "flex items-center gap-3 rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100" do %>
                  <%= heroicon_tag "wrench-screwdriver", variant: :outline, size: 18, class: "h-5 w-5 text-slate-500" %>
                  Materials
                <% end %>
                <% if current_user&.owner? || current_user&.admin? %>
                  <%= link_to invoices_path, class: "flex items-center gap-3 rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100" do %>
                    <%= heroicon_tag "document-text", variant: :outline, size: 18, class: "h-5 w-5 text-slate-500" %>
                    Invoices
                  <% end %>
                  <details class="group">
                    <summary class="flex items-center gap-3 rounded-xl px-3 py-2 text-sm font-semibold text-slate-700 hover:bg-slate-100 cursor-pointer list-none">
                      <%= heroicon_tag "cog-6-tooth", variant: :outline, size: 18, class: "h-5 w-5 text-slate-500" %>
                      Settings
                      <%= heroicon_tag "chevron-down", variant: :solid, size: 14, class: "ml-auto h-4 w-4 text-slate-400 transition group-open:rotate-180" %>
                    </summary>
                    <div class="mt-2 flex flex-col space-y-1 pl-9">
                      <%= link_to edit_settings_company_path, class: "block rounded-lg px-3 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100" do %>
                        Company Details
                      <% end %>
                      <%= link_to customers_path, class: "block rounded-lg px-3 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100" do %>
                        Customers
                      <% end %>
                      <%= link_to users_path, class: "block rounded-lg px-3 py-2 text-sm font-medium text-slate-600 hover:bg-slate-100" do %>
                        Users
                      <% end %>
                    </div>
                  </details>
                <% end %>
              </nav>
              <div class="mt-4 rounded-xl border border-slate-200 px-4 py-3 text-xs text-slate-500">
                <p class="font-semibold text-slate-700"><%= current_account&.name || "" %></p>
                <p class="mt-1"><%= current_user&.display_name || current_user&.email || "" %></p>
              </div>
              <div class="mt-4">
                <%= button_to "Sign out", destroy_user_session_path, method: :delete, class: "w-full rounded-xl bg-slate-900 px-4 py-2 text-xs font-semibold text-white hover:bg-slate-800" %>
              </div>
            </div>
          </div>

          <header class="hidden items-center justify-between border-b border-slate-200 bg-white px-8 py-6 shadow-sm md:flex">
            <div>
              <h1 class="text-xl font-semibold text-slate-900"><%= content_for?(:page_title) ? yield(:page_title) : "Dashboard" %></h1>
            </div>
            <div class="flex items-center gap-4">
            </div>
          </header>

          <main class="flex-1 px-8 py-8">
            <div id="flash">
              <%= render "shared/flash" %>
            </div>

            <%= yield %>
          </main>
        </div>
      </div>
    <% else %>
      <main class="flex min-h-screen items-center justify-center px-6 py-10">
        <div class="w-full max-w-md rounded-2xl bg-white p-8 shadow-xl">
          <div class="mb-6 flex justify-center">
            <%= image_tag "hammertime logo.png", class: "h-16 w-auto object-contain", alt: "Hammertime" %>
          </div>
          <%= yield %>
        </div>
      </main>
    <% end %>
  </body>
</html>
